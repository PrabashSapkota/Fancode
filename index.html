<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fancode Matches</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #150010;
            color: #e0e0e0;
            margin: 0;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2a0322;
        }
        ::-webkit-scrollbar-thumb {
            background: #5a064b;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #7a0864;
        }
        .match-card {
            background: #2a0322;
            border-radius: 1rem;
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border: 1px solid #3a042f;
            height: 280px;
            box-sizing: border-box;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .match-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(90, 6, 75, 0.7);
        }
        .match-card img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-radius: 0.5rem;
        }
        .live-indicator {
            width: 10px;
            height: 10px;
            background-color: #ff4d4d;
            border-radius: 50%;
            margin-right: 0.5rem;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 77, 77, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 77, 77, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 77, 77, 0); }
        }
    </style>
</head>
<body class="min-h-screen">

    <div class="p-6 space-y-10">
        <section>
            <h2 class="text-3xl font-bold mb-4">Live Matches</h2>
            <div id="liveMatches" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>
        </section>

        <section>
            <h2 class="text-3xl font-bold mb-4">Upcoming Matches</h2>
            <div id="upcomingMatches" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>
        </section>
    </div>

    <script>
        const JSON_URL = 'https://raw.githubusercontent.com/Jitendraunatti/fancode/refs/heads/main/data/fancode.json';
        const STREAM_PREFIX = 'https://anym3u8player.com/tv/video-player.php?url=https://mini.allinonereborn.site/sony/stream_proxy.php?url=';

        function createMatchCard(match) {
            const isLive = match.status?.toLowerCase() === 'live' || match.streamingStatus?.toLowerCase() === 'started';
            const teams = match.title ? match.title.split(' vs ') : [];

            const card = document.createElement('div');
            card.className = 'match-card';

            card.innerHTML = `
                ${isLive ? `<div class="flex items-center text-sm mb-2"><div class="live-indicator"></div>Live</div>` : ''}
                <img src="${match.image || 'https://placehold.co/300x150/5a064b/ffffff?text=No+Image'}" alt="${match.title || 'Match'}">
                <h3 class="text-white font-semibold text-lg line-clamp-2">${match.title || 'Unknown Match'}</h3>
                <p class="text-sm text-gray-400 truncate">${teams.join(' vs ')}</p>
                ${
                    isLive
                        ? `<button class="bg-red-600 hover:bg-red-700 text-white font-semibold rounded-full px-4 py-2 mt-2 watch-live-btn" data-url="${match.adfree_stream}" data-title="${match.title}">Watch Live</button>`
                        : `<p class="bg-gray-700 text-gray-200 rounded-full px-4 py-2 mt-2 text-sm text-center">${match.startTime || 'TBA'}</p>`
                }
            `;
            return card;
        }

        async function fetchMatches() {
            const liveMatches = document.getElementById('liveMatches');
            const upcomingMatches = document.getElementById('upcomingMatches');

            liveMatches.innerHTML = '<p class="text-gray-400">Loading...</p>';
            upcomingMatches.innerHTML = '<p class="text-gray-400">Loading...</p>';

            try {
                const res = await fetch(JSON_URL + '?t=' + Date.now());
                const data = await res.json();
                const matches = Array.isArray(data) ? data : data.matches || [];

                liveMatches.innerHTML = '';
                upcomingMatches.innerHTML = '';

                const live = matches.filter(m => m.status?.toLowerCase() === 'live' || m.streamingStatus?.toLowerCase() === 'started');
                const upcoming = matches.filter(m => m.status?.toLowerCase() === 'not_started');

                live.forEach(match => liveMatches.appendChild(createMatchCard(match)));
                upcoming.forEach(match => upcomingMatches.appendChild(createMatchCard(match)));

                document.querySelectorAll('.watch-live-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const rawUrl = btn.getAttribute('data-url');
                        const title = btn.getAttribute('data-title');
                        if (rawUrl) {
                            const fullUrl = `${STREAM_PREFIX}${encodeURIComponent(rawUrl)}`;
                            window.location.href = `player.html?url=${encodeURIComponent(fullUrl)}&title=${encodeURIComponent(title)}`;
                        }
                    });
                });
            } catch (err) {
                console.error('Error loading matches:', err);
                liveMatches.innerHTML = '<p class="text-red-500">Failed to load matches</p>';
                upcomingMatches.innerHTML = '<p class="text-red-500">Failed to load matches</p>';
            }
        }

        window.addEventListener('load', () => {
            fetchMatches();
            setInterval(fetchMatches, 300000);
        });
    </script>
</body>
</html>
